services:
  yocto:
    build:
      context: .
      dockerfile: Dockerfile
    image: emb-linux:22.04
    tty: true
    stdin_open: true
    working_dir: /workspace
    environment:
      - LANG=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
      - CCACHE_DIR=/home/dev/.ccache
      - DL_DIR=/downloads
      - SSTATE_DIR=/sstate
    volumes:
      - ./workspace:/workspace
      # Cache directories: Use shared caches if YOCTO_SHARED_SSTATE_DIR/YOCTO_SHARED_DOWNLOADS_DIR env vars are set
      # Otherwise, use local per-instance caches (default behavior)
      - ${YOCTO_SHARED_SSTATE_DIR:-./sstate}:/sstate
      - ${YOCTO_SHARED_DOWNLOADS_DIR:-./downloads}:/downloads
    # Resource limits: Uncomment and adjust values to limit resource usage
    # Useful when running multiple instances simultaneously
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '4'
    #       memory: 8G
    #     reservations:
    #       cpus: '2'
    #       memory: 4G
    command: bash -lc "bash"

